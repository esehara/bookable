{% extends "base.html" %}

{% block extheader %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.autopager-1.0.0.min.js"></script>
<script type="text/javascript">
    $(function(){
        $.autopager({
            link: '#nextlink',
            appendTo: '.contentwrapper'
            });
        var focus_status = 0;
        var previous_status = 0;
        var is_animate = false;
        var slideFunction = function() {
            var target_position;
            var elem = $('.books-favorite li.image').get(focus_status);
            if (typeof elem === "undefined") {
                focus_status = previous_status;
            } else {
                target_position = $(elem).offset();
                is_animate = true;
                $('html, body').animate({scrollTop: target_position.top - 24}, 'fast', function() {
                   is_animate = false; 
                });
            }
        };
        var check_position = function() {
            var position = $('body').scrollTop();
            if (!is_animate) {
            $('.books-favorite .books-container').each(function(index, dom) {
                var elem_top = $(dom).offset().top;
                var elem_bottom = $(dom).height() + elem_top;

                if (position > elem_top && elem_bottom > position) {
                        focus_status = index + 1;
                    }
                });
            }
        }

        window.setInterval(check_position, 1000);

        $(document).keypress(function(keyevent) {
            var is_button_push = false;
            var key_check = function(_keyevent, number) {
                return _keyevent.keyCode === number || _keyevent.charCode === number;
            }

            console.log(keyevent.keyCode);
            previous_status = focus_status; 
            if (key_check(keyevent, 106)) {
                focus_status ++;
                is_button_push = true;
            } else if (key_check(keyevent, 107)) {
                focus_status --;
                is_button_push = true;
            }

            if (key_check(keyevent, 32)) {
                check_position();
            }

            if (focus_status < 0) {
                focus_status = 0;
                is_button_push = false;
            }

            if (is_button_push) {
                slideFunction();
            }

            });
    });
</script>
{% endblock %}

{% block contents %}
<div class="contentwrapper">
    <div class="content">
    <div class="books-favorite">    
        <div class="wrapper-h2">
            <h2> 50user++ </h2>
        </div>
    {% for book in favorite_books %}
        {% include "books.html" %}
    {% endfor %} 
    </div> 
    <div class="books-normal">
        <div class="wrapper-h2">
            <h2>50user - 25user </h2>
        </div>
    {% for book in normal_books %}
        {% include "books.html" %}
    {% endfor %}
    </div>
    
    <div class="books-hot">
        <div class="wrapper-h2">
            <h2>25user - 10user</h2>
        </div>
    {% for book in hot_books %}
        {% include "books.html" %}
    {% endfor %}
    </div>
    
    <div class="books-newbee">
        <div class="wrapper-h2">
            <h2>10user-- </h2>
        </div>
        {% for book in newbee_books %}
            {% include "books.html" %}
        {% endfor %}
    </div>
    </div>
</div>
<div id="reloadbutton">
    <a href="/">RELOAD</a>
</div>
<a href="/" ref="next" id="nextlink">Reload</a>

{% endblock %}
